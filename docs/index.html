<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf8">
        <title>Flight Delays</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ==" crossorigin="">
        <style>
            #map { width: 720px; height: 360px; }
        </style>
    </head>
    <body>
        <div id="map"></div>

        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
        <script src="https://unpkg.com/heatmapjs@2.0.2/heatmap.min.js"></script>
        <script src="https://unpkg.com/leaflet-heatmap@1.0.0/leaflet-heatmap.js"></script>
        <script>
let heatmapLayer = new HeatmapOverlay({
    radius: .75, maxOpacity: 0.8, scaleRadius: true, useLocalExtrema: false,
    latField: 'Lat', lngField: 'Lng', valueField: 'DepDelay'
})

let baseLayer = new L.tileLayer('https://a.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
    id: 'mapbox.world-bright',
    maxZoom: 11,
    attribution: '© <a href="https://www.mapbox.com/about/maps/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> <strong><a href="https://www.mapbox.com/map-feedback/" target="_blank">Improve this map</a></strong>'
})

let map = new L.map('map', {
    center: new L.LatLng(37.8, -96), 
    zoom: 4,
    layers: [baseLayer, heatmapLayer]
})

d3.csv('../data/airports-delay.csv', (data) =>
    heatmapLayer.setData({
        data: data,
        max: d3.max(data, (row) => row.DepDelay)
    })
)

        </script>
    </body>
</html>
